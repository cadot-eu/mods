<!DOCTYPE html>
<html lang="fr" x-data="promptApp()" x-init="init()">
<head>
  <meta charset="UTF-8">
  <title>Prompt Generator</title>

  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/darkly/bootstrap.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="container py-4">

  <div class="card shadow">
    <div class="card-header d-flex gap-2 align-items-center">
      <i class="bi bi-pencil-square"></i>
      <strong>Générateur de prompt IA</strong>
    </div>
    <div class="card-body d-flex flex-column gap-3">

      <input type="text" class="form-control" placeholder="Nom du plugin" x-model="pluginName">

      <textarea class="form-control" rows="2"
                placeholder="But du plugin (ex: gérer fuseau horaire, récupérer données API...)"
                x-model="purpose"></textarea>

      <div class="mt-3">
        <label class="form-label fw-bold">Routes Fastify (optionnel)</label>
        <small class="text-muted d-block mb-2">Exemple : GET /api/timezone/list, POST /api/timezone</small>
        <textarea class="form-control" rows="3" 
                  placeholder="GET /api/example, POST /api/example"
                  x-model="routes"></textarea>
      </div>

      <div class="mt-3">
        <label class="form-label fw-bold">API partagées (fastify.NOM_PLUGIN) (optionnel)</label>
        <small class="text-muted d-block mb-2">Exemple : timezone.getTime(timezone), timezone.getList()</small>
        <textarea class="form-control" rows="3" 
                  placeholder="nomPlugin.methode1(), nomPlugin.methode2(param)"
                  x-model="apiText"></textarea>
      </div>

      <button class="btn btn-primary mt-3" @click="generatePrompt">
        Générer le prompt
      </button>

      <div class="mt-3">
        <label class="form-label fw-bold">Prompt généré</label>
        <textarea class="form-control" rows="8" x-model="prompt" readonly></textarea>
      </div>

      <div class="mt-3 d-none">
        <label class="form-label fw-bold">Nom du plugin</label>
        <input type="text" class="form-control" 
               placeholder="nom-plugin"
               x-model="pluginName">
      </div>

      <div class="mt-3">
        <label class="form-label fw-bold">Code JavaScript principal</label>
        <textarea class="form-control" rows="5" 
                  placeholder="Collez votre code JavaScript ici..."
                  x-model="mainFileContent"></textarea>
      </div>

      <!-- Section Configuration -->
      <div class="mt-3">
        <label class="form-label fw-bold">Fichiers de configuration</label>
        <small class="text-muted d-block mb-2">Ces fichiers seront enregistrés dans /app/config/ lors de la création du plugin</small>
        <button class="btn btn-info text-white" @click="addConfigFile">
          <i class="bi bi-plus"></i> Ajouter un fichier de config
        </button>
      </div>

      <div class="mt-3" x-show="configFiles.length > 0">
        <div class="row">
          <template x-for="(config, index) in configFiles" :key="index">
            <div class="col-md-6 mb-3">
              <div class="card">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-8">
                      <input type="text" class="form-control mb-2" 
                             placeholder="nom-fichier.yaml"
                             x-model="config.name">
                    </div>
                    <div class="col-md-4">
                      <button class="btn btn-danger" @click="removeConfigFile(index)">
                        <i class="bi bi-x"></i>
                      </button>
                    </div>
                  </div>
                  <textarea class="form-control" rows="5" 
                            placeholder="Contenu de la configuration..."
                            x-model="config.content"></textarea>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>

      <div class="mt-3">
        <button class="btn btn-success" @click="addAdditionalFile">
          <i class="bi bi-plus"></i> Ajouter fichier
        </button>
      </div>

      <div class="mt-3" x-show="additionalFiles.length > 0">
        <label class="form-label fw-bold">Fichiers supplémentaires</label>
        <div class="row" x-show="additionalFiles.length > 0">
          <template x-for="(file, index) in additionalFiles" :key="index">
            <div class="col-md-6 mb-3">
              <div class="card">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-8">
                      <input type="text" class="form-control mb-2" 
                             placeholder="nom-fichier.html"
                             x-model="file.name">
                    </div>
                    <div class="col-md-4">
                      <button class="btn btn-danger" @click="removeAdditionalFile(index)">
                        <i class="bi bi-x"></i>
                      </button>
                    </div>
                  </div>
                  <textarea class="form-control" rows="5" 
                            placeholder="Contenu du fichier..."
                            x-model="file.content"></textarea>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>

      <div class="mt-3">
        <button class="btn btn-success" @click="createPlugin">
          <i class="bi bi-box-arrow-in-down"></i> Créer le plugin
        </button>
      </div>

    </div>
  </div>

  <script src="/api/prompt-generator/app.js"></script>
</body>
</html>
