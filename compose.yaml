services:
  mods:
    image: node:25-alpine
    container_name: mods
    working_dir: /app
    environment:
      - NODE_ENV=${NODE_ENV:-development}
    volumes:
      - ./app:/app
      - node_modules:/app/node_modules
    ports:
      - "3000:3000"
    command: >
      sh -c '
        apk add --no-cache su-exec
        npm ci 2>/dev/null || npm install
        mkdir -p logs uploads data
        chown -R ${UID:-1000}:${GID:-1000} logs uploads data
        exec su-exec ${UID:-1000}:${GID:-1000} node index.js
      '
    restart: ${RESTART_POLICY:-unless-stopped}

volumes:
  node_modules: