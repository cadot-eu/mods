services:
  mods:
    image: node:25-alpine
    container_name: mods
    working_dir: /app
    user: "${UID:-1000}:${GID:-1000}"
    group_add:
      - "${GID:-1000}"
    environment:
      - NODE_ENV=${NODE_ENV:-development}
      - UID=${UID:-1000}
      - GID=${GID:-1000}
    volumes:
      - ./app:/app
      - /app/node_modules  # Volume anonyme
    ports:
      - "3000:3000"
    command: >
      sh -eu -c '
        cd /app
        if [ "${NODE_ENV}" = "production" ]; then
          if [ -f package-lock.json ]; then npm ci --only=production; else npm install --omit=dev; fi
          exec node index.js
        else
          if [ -f package-lock.json ]; then npm ci; else npm install; fi
          exec node index.js
        fi
      '
    restart: ${RESTART_POLICY:-unless-stopped}

